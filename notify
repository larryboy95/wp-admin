#!/bin/sh
USAGE="
$(basename $0) Version 0.1.3

Usage: $(basename $0) MESSAGE 

Sends MESSAGE as a tweet from the non-critical account.
Configured in ~/.tw.conf

Depends on:
- https://github.com/hrs/markov-sentence-generator
- https://github.com/piroor/tweet.sh
"
# Print USAGE if no args
if [ $# -eq 0 ]; then
    echo "$USAGE"
    exit 1
fi

lastRun=$(cat "${HOME}/.tw.lastRun")
sinceLastRun=`expr $(date +%s) - $lastRun`
if [ $sinceLastRun -lt 30 ]; then
	echo "$sinceLastRun is too short"
	exit 1
fi

if [ -f /usr/local/bin/tweet.sh ]; then
	markov=$(/opt/markov-sentence-generator/sentence-generator.py /opt/markov-sentence-generator/360.txt.utf-8 5 | cut -d " " -f 1-20)
	. "${HOME}/.tw.conf"
	tweet.sh post "${1} ${markov}" > /dev/null 2>&1
	echo $(date +%s) > "${HOME}/.tw.lastRun"
else 
	echo "Could not find tweet.sh"
fi
echo $1
exit 0
