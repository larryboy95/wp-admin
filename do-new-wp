#!/bin/bash

if [ $# -eq 0 ]; then
    echo "

Usage: do-new-wp CONFIGFILE

Config file vars, required:
DOTOKEN
PUBLICKEY

ADMINIP is automatically pulled from eth0

Optional vars and their default values:
SIZE s-1vcpu-1gb
IMAGE lemp-16-04
REGION sfo2
NAME unnamed

"
    exit 1
fi
# Include the config file
. $1
ADMINIP="$(ifconfig | grep -A 1 'eth0' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
SIZE=${SIZE:-s-1vcpu-1gb}
IMAGE=${IMAGE:-lemp-16-04}
REGION=${REGION:-sfo2}
NAME=${NAME:-unnamed}
# add ses creds
# generate db/wp passwords
# auto retrieve admin ip
# generate doer config file in /tmp

# Provision the droplet
doctl compute droplet create \
    ${NAME} \
    -t ${DOTOKEN} \
    -o json \
    --size ${SIZE} \
    --image ${IMAGE} \
    --region ${REGION} \
    --enable-backups \
    --enable-monitoring \


# Need ip back from do

# Run ansible playbook to set up servers

# Run wordpress-install new / clone repo

# Uploads dir??

exit 0
