#!/bin/bash

deploypath=${2:-/var/www/html}

rsync -qr \
	--filter=':- /var/repos/${1}/.gitignore' \
	--delete \
 	/var/repos/${1}/ ${1}:${deploypath}
wordpress-permissions "$1"
if [ ! $? -eq 0 ]; then
	notify-critical "rsync exited with code $? for ${LOGNAME}@${HOSTNAME} \
		while attempting to deploy ${1}"
fi

wordpress-permissions "$1"
if [  $? -eq 0 ]; then
	notify "Deploy complete for ${1}:${2} by ${LOGNAME}@${HOSTNAME}"
else
	notify-critical "wordpress-permissions exited with code $? for ${LOGNAME}@${HOSTNAME} \
		while attempting to deploy ${1}"
fi

exit 0
