#!/bin/bash

cd ~/db-backups
pwd
target=${1}.sql

echo "Rotate backups"
mv -v ${1}.7.sql.gz ${1}.8.sql.gz
mv -v ${1}.6.sql.gz ${1}.7.sql.gz
mv -v ${1}.5.sql.gz ${1}.6.sql.gz
mv -v ${1}.4.sql.gz ${1}.5.sql.gz
mv -v ${1}.3.sql.gz ${1}.4.sql.gz
mv -v ${1}.2.sql.gz ${1}.3.sql.gz
mv -v ${1}.1.sql.gz ${1}.2.sql.gz
mv -v ${1}.sql.gz ${1}.1.sql.gz

# Setup ssh hosts first in ~/.ssh/config
args="--path=/var/www/html --ssh=$1"

echo "Export db from WordPress..."
wp $args db export - > "${target}"

# Zip that shit up
gzip -vf ${target}

exit 0
